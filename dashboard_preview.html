<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard — Today</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f5f5; color: #111827;
    display: flex; min-height: 100vh;
  }

  /* ── Sidebar ── */
  .sidebar {
    width: 220px; background: #1e293b; color: #e2e8f0;
    padding: 1.5rem 1rem; flex-shrink: 0;
  }
  .sidebar h2 {
    font-size: 0.9rem; margin-bottom: 1.5rem; color: #fff;
    letter-spacing: 0.03em; font-weight: 600;
  }
  .sidebar a {
    display: block; padding: 0.5rem 0.75rem; border-radius: 6px;
    color: #94a3b8; text-decoration: none; font-size: 0.85rem; margin-bottom: 2px;
  }
  .sidebar a.active { background: #334155; color: #fff; font-weight: 600; }
  .sidebar a:hover { background: #334155; color: #fff; }

  /* ── Main ── */
  .main { flex: 1; padding: 2.5rem; }
  .content { max-width: 960px; margin: 0 auto; }

  /* ── Header ── */
  .header {
    display: flex; align-items: baseline; justify-content: space-between;
    margin-bottom: 1.5rem;
  }
  .header h1 {
    font-size: 1.75rem; font-weight: 700; color: #111827;
    margin-bottom: 0.2rem;
  }
  .header .issue-count {
    font-weight: 400; font-size: 1rem; color: #6b7280;
  }
  .header .date {
    font-size: 0.85rem; color: #9ca3af;
    display: block;
  }

  /* ── View toggle ── */
  .view-toggle { display: flex; gap: 0.35rem; }
  .view-toggle button {
    padding: 0.3rem 0.85rem; border-radius: 5px;
    border: 1px solid #d1d5db; background: #fff; color: #6b7280;
    font-size: 0.8rem; font-weight: 500; cursor: pointer;
  }
  .view-toggle button.on {
    background: #111827; color: #fff; border-color: #111827;
  }

  /* ── Resolved row (sorted view) ── */
  .resolved-row {
    display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;
    align-items: center;
    padding: 0.6rem 1rem 0.6rem 12px;
    border-bottom: 1px solid #f3f4f6;
    border-left: 3px solid #d1fae5;
    background: #fff;
  }
  .resolved-row .action-taken {
    font-size: 0.85rem; color: #059669; font-weight: 500;
  }

  /* ── Sorted banner ── */
  .sorted-banner {
    padding: 3rem 1.5rem; text-align: center; border-radius: 8px;
    border: 1px solid #e5e7eb; background: #fafafa;
  }
  .sorted-banner p {
    font-size: 1.05rem; font-weight: 500; color: #374151;
  }

  /* ── Column headers ── */
  .col-headers {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;
    padding: 0 0 0.5rem 15px;
    border-bottom: 1px solid #e5e7eb; margin-bottom: 0;
  }
  .col-headers span {
    font-size: 0.7rem; font-weight: 600; color: #9ca3af;
    text-transform: uppercase; letter-spacing: 0.05em;
  }

  /* ── Issue row ── */
  .row {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;
    align-items: center;
    padding: 0.75rem 1rem 0.75rem 12px;
    border-bottom: 1px solid #f3f4f6;
    border-left: 3px solid #d1d5db;
    background: #fff;
    transition: opacity 0.3s ease;
  }
  .row.sev-critical { border-left-color: #ef4444; }
  .row.sev-high     { border-left-color: #f59e0b; }
  .row.resolving    { opacity: 0.5; pointer-events: none; }
  .row.resolved     {
    opacity: 0; height: 0; padding: 0; margin: 0;
    border: none; overflow: hidden;
    transition: opacity 0.3s ease, height 0s 0.3s;
  }

  /* ── Col 1: What happened ── */
  .row-what .summary {
    font-size: 0.9rem; font-weight: 600; color: #111827; line-height: 1.3;
  }
  .row-what .context {
    font-size: 0.8rem; color: #9ca3af; margin-top: 0.1rem;
  }

  /* ── Col 2: Primary action ── */
  .btn-primary {
    display: inline-block; padding: 0.45rem 1rem;
    border-radius: 5px; border: none;
    background: #111827; color: #fff;
    font-size: 0.85rem; font-weight: 500;
    cursor: pointer; white-space: nowrap;
    transition: background 0.15s;
  }
  .btn-primary:hover { background: #1f2937; }
  .btn-reason {
    display: block; font-size: 0.7rem; color: #9ca3af; margin-top: 0.2rem;
  }
  .row-feedback {
    font-size: 0.85rem; color: #374151; font-weight: 500;
    display: none;
  }
  .row.resolving .row-feedback { display: block; }
  .row.resolving .row-action-live { display: none; }

  /* ── Col 3: Alternatives ── */
  .row-alts { display: flex; flex-wrap: wrap; gap: 0.4rem; }
  .btn-secondary {
    padding: 0.3rem 0.65rem; border-radius: 4px;
    border: 1px solid #d1d5db; background: #fff; color: #374151;
    font-size: 0.78rem; cursor: pointer; white-space: nowrap;
    transition: background 0.15s;
  }
  .btn-secondary:hover { background: #f3f4f6; }
  .row.resolving .row-alts { visibility: hidden; }

  /* ── Dev toggle ── */
  .preview-toggle {
    position: fixed; bottom: 1rem; right: 1rem;
    display: flex; gap: 0.4rem; z-index: 10;
  }
  .preview-toggle button {
    padding: 0.35rem 0.75rem; border-radius: 5px;
    border: 1px solid #d1d5db; background: #fff; color: #374151;
    font-size: 0.75rem; cursor: pointer;
  }
  .preview-toggle button.active {
    background: #111827; color: #fff; border-color: #111827;
  }
</style>
</head>
<body>

<!-- ── Sidebar ── -->
<nav class="sidebar">
  <h2>NBNE Platform</h2>
  <a href="#" class="active">Today</a>
  <a href="#">Bookings</a>
  <a href="#">Staff</a>
  <a href="#">Clients</a>
  <a href="#">Compliance</a>
  <a href="#">Documents</a>
  <a href="#">CRM</a>
  <a href="#">Analytics</a>
  <a href="#">Comms</a>
  <a href="#">Settings</a>
</nav>

<!-- ── Main ── -->
<div class="main">
<div class="content">

  <!-- Header -->
  <div class="header">
    <div>
      <h1>Today<span class="issue-count" id="issue-count"> &mdash; 3 issues</span></h1>
      <span class="date" id="today-date"></span>
    </div>
    <div class="view-toggle">
      <button class="on" id="btn-active" onclick="switchView('active')">Active</button>
      <button id="btn-sorted" onclick="switchView('sorted')">Sorted</button>
    </div>
  </div>

  <!-- ═══ STATE A: Active ═══ -->
  <div id="state-active">

    <!-- Column headers -->
    <div class="col-headers">
      <span>What happened</span>
      <span>Action</span>
      <span>Alternatives</span>
    </div>

    <!-- Row 1: Operational blocker — staff sick -->
    <div class="row sev-critical" id="row-1">
      <div class="row-what">
        <div class="summary">4 bookings affected</div>
        <div class="context">Chloe off sick today</div>
      </div>
      <div>
        <div class="row-action-live">
          <button class="btn-primary" onclick="resolveRow('row-1','Request cover from Sam')">Request cover from Sam</button>
          <span class="btn-reason">Next in 7-day rotation</span>
        </div>
        <div class="row-feedback">Request sent to Sam &mdash; awaiting response</div>
      </div>
      <div class="row-alts">
        <button class="btn-secondary" onclick="resolveRow('row-1','Request cover from Jordan')">Request Jordan</button>
        <button class="btn-secondary" onclick="resolveRow('row-1','Owner cover')">Owner cover</button>
      </div>
    </div>

    <!-- Row 2: Operational blocker — unassigned booking -->
    <div class="row sev-critical" id="row-2">
      <div class="row-what">
        <div class="summary">11:00 booking unassigned</div>
        <div class="context">Full Colour &mdash; Emma Watson</div>
      </div>
      <div>
        <div class="row-action-live">
          <button class="btn-primary" onclick="resolveRow('row-2','Assign Sam')">Assign Sam</button>
          <span class="btn-reason">Available for Full Colour</span>
        </div>
        <div class="row-feedback">Assigned to Sam</div>
      </div>
      <div class="row-alts">
        <button class="btn-secondary" onclick="resolveRow('row-2','Assign Jordan')">Assign Jordan</button>
        <button class="btn-secondary" onclick="resolveRow('row-2','Reschedule')">Reschedule</button>
      </div>
    </div>

    <!-- Row 3: Revenue risk — deposit missing -->
    <div class="row sev-high" id="row-3">
      <div class="row-what">
        <div class="summary">&pound;85 deposit missing &mdash; 14:00</div>
        <div class="context">Sarah Connor &mdash; Balayage</div>
      </div>
      <div>
        <div class="row-action-live">
          <button class="btn-primary" onclick="resolveRow('row-3','Request payment')">Request payment</button>
          <span class="btn-reason">&pound;85.00 outstanding</span>
        </div>
        <div class="row-feedback">Payment request sent</div>
      </div>
      <div class="row-alts">
        <button class="btn-secondary" onclick="resolveRow('row-3','Mark as paid')">Mark as paid</button>
        <button class="btn-secondary" onclick="resolveRow('row-3','Cancel booking')">Cancel booking</button>
      </div>
    </div>

  </div>

  <!-- ═══ Sorted view: resolved today ═══ -->
  <div id="view-sorted" style="display: none;">
    <div id="resolved-list"></div>
    <div id="resolved-empty" class="sorted-banner">
      <p>Nothing resolved yet today.</p>
    </div>
  </div>

  <!-- ═══ All clear banner ═══ -->
  <div id="all-clear" style="display: none;">
    <div class="sorted-banner">
      <p>All issues resolved. Sorted.</p>
    </div>
  </div>

</div>
</div>

<!-- Dev: reset button -->
<div class="preview-toggle">
  <button class="active" onclick="resetDemo()">Reset Demo</button>
</div>

<script>
  document.getElementById('today-date').textContent =
    new Date().toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });

  const totalRows = 3;
  let resolvedCount = 0;
  let currentView = 'active';
  const resolvedItems = [];

  // Row data for building resolved view
  const rowData = {
    'row-1': { summary: '4 bookings affected', context: 'Chloe off sick today' },
    'row-2': { summary: '11:00 booking unassigned', context: 'Full Colour \u2014 Emma Watson' },
    'row-3': { summary: '\u00A385 deposit missing \u2014 14:00', context: 'Sarah Connor \u2014 Balayage' },
  };

  function resolveRow(id, label) {
    const row = document.getElementById(id);
    if (!row || row.classList.contains('resolving')) return;

    const fb = row.querySelector('.row-feedback');
    fb.textContent = label + ' \u2014 awaiting response';
    row.classList.add('resolving');

    setTimeout(() => {
      row.classList.add('resolved');
      resolvedCount++;
      resolvedItems.push({ ...rowData[id], action: label });
      updateHeader();
      renderResolved();

      if (resolvedCount >= totalRows) {
        document.getElementById('state-active').style.display = 'none';
        document.getElementById('all-clear').style.display = 'block';
      }
    }, 1500);
  }

  function updateHeader() {
    const remaining = totalRows - resolvedCount;
    const el = document.getElementById('issue-count');
    if (remaining <= 0) {
      el.textContent = '';
    } else {
      el.innerHTML = ' &mdash; ' + remaining + ' issue' + (remaining !== 1 ? 's' : '');
    }
    // Update sorted button count
    const btnSorted = document.getElementById('btn-sorted');
    btnSorted.textContent = 'Sorted' + (resolvedItems.length > 0 ? ' (' + resolvedItems.length + ')' : '');
  }

  function renderResolved() {
    const list = document.getElementById('resolved-list');
    const empty = document.getElementById('resolved-empty');
    if (resolvedItems.length === 0) {
      list.innerHTML = '';
      empty.style.display = 'block';
      return;
    }
    empty.style.display = 'none';
    list.innerHTML = resolvedItems.map(r =>
      '<div class="resolved-row">' +
        '<div class="row-what">' +
          '<div class="summary">' + r.summary + '</div>' +
          '<div class="context">' + r.context + '</div>' +
        '</div>' +
        '<div class="action-taken">' + r.action + '</div>' +
      '</div>'
    ).join('');
  }

  function switchView(view) {
    currentView = view;
    const btnActive = document.getElementById('btn-active');
    const btnSorted = document.getElementById('btn-sorted');
    btnActive.classList.toggle('on', view === 'active');
    btnSorted.classList.toggle('on', view === 'sorted');

    if (view === 'sorted') {
      document.getElementById('state-active').style.display = 'none';
      document.getElementById('all-clear').style.display = 'none';
      document.getElementById('view-sorted').style.display = 'block';
      renderResolved();
    } else {
      document.getElementById('view-sorted').style.display = 'none';
      if (resolvedCount >= totalRows) {
        document.getElementById('state-active').style.display = 'none';
        document.getElementById('all-clear').style.display = 'block';
      } else {
        document.getElementById('state-active').style.display = 'block';
        document.getElementById('all-clear').style.display = 'none';
      }
    }
  }

  function resetDemo() {
    resolvedCount = 0;
    resolvedItems.length = 0;
    currentView = 'active';
    document.getElementById('state-active').style.display = 'block';
    document.getElementById('view-sorted').style.display = 'none';
    document.getElementById('all-clear').style.display = 'none';
    document.getElementById('btn-active').classList.add('on');
    document.getElementById('btn-sorted').classList.remove('on');
    document.querySelectorAll('.row').forEach(r => {
      r.classList.remove('resolving', 'resolved');
      r.style.height = ''; r.style.padding = ''; r.style.margin = '';
      r.style.border = ''; r.style.overflow = '';
    });
    updateHeader();
    renderResolved();
  }
</script>

</body>
</html>
